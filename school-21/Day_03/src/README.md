# API для поиска ресторанов

Этот проект предоставляет простой REST API для поиска ресторанов в Москве с использованием Elasticsearch. Включены функции для отображения списка ресторанов, рекомендации ближайших ресторанов на основе географических координат и аутентификации запросов с использованием JWT токенов.

## Структура проекта

```
src/
├── create/
│   ├── cd.go
│   └── data.csv
├── db/
│   └── db.go
└── main.go
```

### Папки и файлы

- **src/create/cd.go**: Содержит код для создания индекса в Elasticsearch и загрузки данных из CSV файла (`data.csv`) в Elasticsearch.
- **src/create/data.csv**: Набор данных, содержащий информацию о ресторанах, включая ID, название, адрес, телефон, широту и долготу.
- **src/db/db.go**: Содержит код для взаимодействия с Elasticsearch, включая функции для получения мест и рекомендации ближайших мест на основе географических координат.
- **src/main.go**: Содержит основную реализацию сервера, включая конечные точки для отображения списка ресторанов, рекомендации ближайших ресторанов и генерации JWT токенов для аутентификации.


### Установка

**Установите зависимости**:

```bash
go mod tidy
```

### Настройка Elasticsearch

1. **Запустите Elasticsearch**:

Убедитесь, что Elasticsearch запущен на `http://localhost:9200`.

2. **Загрузите данные в Elasticsearch**:

```bash
cd create
go run cd.go
```

Эта команда создаст индекс с названием `places` в Elasticsearch и загрузит данные из `data.csv`.

### Запуск сервера

```bash
cd ..
go run main.go
```

Сервер запустится на `http://127.0.0.1:8888`.

## Конечные точки API

### Получить токен

**URL**: `/api/get_token`

**Метод**: `GET`

**Описание**: Генерирует JWT токен для аутентификации.

**Ответ**:

```json
{
  "token": "your_jwt_token"
}
```

### Список мест

**URL**: `/api/places?page=<page_number>`

**Метод**: `GET`

**Описание**: Возвращает постраничный список ресторанов.

**Ответ**:

```json
{
  "name": "Places",
  "total": 13649,
  "places": [
    {
      "id": "1",
      "name": "Название ресторана",
      "address": "Адрес",
      "phone": "Телефон",
      "location": {
        "lat": 55.123456,
        "lon": 37.123456
      }
    }
    ...
  ],
  "prev_page": <номер предыдущей страницы>,
  "next_page": <номер следующей страницы>,
  "last_page": <номер последней страницы>
}
```

### Рекомендация ближайших мест

**URL**: `/api/recommend?lat=<latitude>&lon=<longitude>`

**Метод**: `GET`

**Описание**: Возвращает три ближайших ресторана к указанным координатам. Требуется аутентификация.

**Заголовки**:

- `Authorization: Bearer <your_jwt_token>`

**Ответ**:

```json
{
  "name": "Recommendation",
  "places": [
    {
      "id": "1",
      "name": "Ближайший ресторан 1",
      "address": "Адрес",
      "phone": "Телефон",
      "location": {
        "lat": 55.123456,
        "lon": 37.123456
      }
    },
    ...
  ]
}
```

### Тестирование с помощью Postman

1. **Получить токен**:
    - Метод: `GET`
    - URL: `http://127.0.0.1:8888/api/get_token`

2. **Список мест**:
    - Метод: `GET`
    - URL: `http://127.0.0.1:8888/api/places?page=1`

3. **Рекомендация ближайших мест**:
    - Метод: `GET`
    - URL: `http://127.0.0.1:8888/api/recommend?lat=55.674&lon=37.666`
    - Заголовки:
        - `Authorization: Bearer <your_jwt_token>`

Убедитесь, что заменили `<your_jwt_token>` на реальный токен, полученный с конечной точки `/api/get_token`.
