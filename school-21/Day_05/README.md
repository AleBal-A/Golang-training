# Anomaly Detection Project

## Описание проекта

Этот проект представляет собой систему обнаружения аномалий в потоках данных частоты. Система включает сервер, который генерирует поток данных с использованием gRPC, и клиента, который получает этот поток, вычисляет статистику и обнаруживает аномалии. Все обнаруженные аномалии сохраняются в базе данных PostgreSQL с использованием GORM ORM.

### Структура проекта

```plaintext
.
├── anomaly_detector
│   └── anomaly_cli.go
├── client
│   └── client.go
├── db_sql
│   └── docker-compose.yml
├── go.mod
├── go.sum
├── server
│   └── server.go
├── transmitter
│   ├── transmitter.pb.go
│   ├── transmitter.proto
│   └── transmitter_grpc.pb.go
└── vendor
```

## Инструкции по запуску

### Шаги

#### 1. Развертывание базы данных

Перейдите в директорию `db_sql` и выполните команду:

```sh
docker-compose up -d
```

Это развернет PostgreSQL с настройками, указанными в файле `docker-compose.yml`.

#### 2. Запуск сервера

Перейдите в директорию `server` и выполните команду:

```sh
go run server.go
```

Сервер начнет генерировать поток данных с случайными значениями частоты и отправлять их клиенту через gRPC.

#### 3. Запуск клиента

Перейдите в директорию `anomaly_detector.go` и выполните команду:

```sh
go run anomaly_cli.go -k 1.9
```

Где `-k` - коэффициент для обнаружения аномалий. Клиент будет получать поток данных от сервера, вычислять статистику, обнаруживать аномалии и сохранять их в базу данных.

## Детали реализации

Сервер генерирует уникальный `session_id` и случайные значения для среднего (mean) и стандартного отклонения (STD) для каждого нового подключения. Эти значения записываются в лог. Сервер отправляет поток данных, где каждое сообщение содержит `session_id`, `frequency` и текущую временную метку (timestamp) в формате UTC.

Клиент получает поток данных от сервера и вычисляет приближенные значения среднего (mean) и стандартного отклонения (STD) на основе полученных данных. После обработки 50 значений клиент переходит в режим обнаружения аномалий, используя заданный коэффициент (k). Аномалией считается значение, которое отклоняется от ожидаемого значения на больше чем k * STD. Обнаруженные аномалии записываются в лог.

Все обнаруженные аномалии сохраняются в базе данных PostgreSQL с использованием ORM (GORM). Описание записей (session_id, frequency, timestamp) реализовано в виде структуры в Go и отображается в столбцы базы данных.
